<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Henry Games – Görsel ↔ TXT</title>

<style>
:root{
  --bg:#F6F1E8;
  --primary:#2FAF9B;
  --primary-light:#6FD6C4;
  --text:#1F2A2A;
  --border:#C9E6DF;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  display:flex;
  align-items:center;
  gap:16px;
  padding:24px 32px;
}

header img{height:64px}

main{padding:32px}

.card{
  background:#ffffffcc;
  border:1px solid var(--border);
  border-radius:16px;
  padding:24px;
  max-width:900px;
}

.section{
  margin-top:24px;
}

label{
  font-size:.9rem;
  opacity:.75;
}

.row{
  display:flex;
  gap:16px;
  align-items:center;
  flex-wrap:wrap;
}

input[type="file"],
input[type="number"]{
  padding:8px;
}

button{
  background:var(--primary);
  color:white;
  border:none;
  padding:10px 16px;
  border-radius:10px;
  cursor:pointer;
}

button:hover{background:var(--primary-light)}

.preview{
  margin-top:16px;
  max-width:100%;
  border-radius:12px;
  border:1px dashed var(--border);
}
</style>
</head>

<body>

<header>
  <img src="logo.png" alt="Henry Games Logo">
  <h1>Henry Games</h1>
</header>

<main>
<div class="card">

<h2>Görsel ↔ TXT Dönüştürücü</h2>

<!-- GÖRSEL → TXT -->
<div class="section">
  <label>PNG / JPEG / WEBP görsel yükle (yüklenince otomatik TXT oluşur)</label>
  <div class="row">
    <input type="file" id="imageInput" accept="image/png,image/jpeg,image/webp">
    <button onclick="downloadTXT()">TXT olarak indir</button>
  </div>
</div>

<!-- TXT → GÖRSEL -->
<div class="section">
  <label>TXT veya özel format dosyanı yükle (yüklenince görsel olur)</label>
  <div class="row">
    <input type="file" id="txtInput" accept=".txt">
    <button onclick="renderFromTXT()">Görsele çevir</button>
  </div>
</div>

<!-- PİKSEL AYARLARI -->
<div class="section">
  <label>Piksel boyutu (opsiyonel)</label>
  <div class="row">
    <input type="number" id="w" placeholder="Genişlik (px)">
    <input type="number" id="h" placeholder="Yükseklik (px)">
    <button onclick="applySize()">Uygula</button>
  </div>
</div>

<img id="preview" class="preview">

</div>
</main>

<script>
let canvas=document.createElement("canvas");
let ctx=canvas.getContext("2d");
let lastImage=null;
let generatedTXT="";

imageInput.onchange=e=>{
  const file=e.target.files[0];
  if(!file)return;
  const img=new Image();
  img.onload=()=>{
    canvas.width=img.width;
    canvas.height=img.height;
    ctx.drawImage(img,0,0);
    lastImage=img;
    preview.src=canvas.toDataURL();
    generateTXT();
  }
  img.src=URL.createObjectURL(file);
};

function generateTXT(){
  const data=ctx.getImageData(0,0,canvas.width,canvas.height).data;
  let txt=`${canvas.width},${canvas.height}\n`;
  for(let i=0;i<data.length;i+=4){
    txt+=`${data[i]},${data[i+1]},${data[i+2]},${data[i+3]}\n`;
  }
  generatedTXT=txt;
}

function downloadTXT(){
  const blob=new Blob([generatedTXT],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="image.txt";
  a.click();
}

txtInput.onchange=e=>{
  const file=e.target.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=()=>drawFromTXT(reader.result);
  reader.readAsText(file);
};

function drawFromTXT(txt){
  const lines=txt.trim().split("\n");
  const [w,h]=lines[0].split(",").map(Number);
  canvas.width=w;
  canvas.height=h;
  const imgData=ctx.createImageData(w,h);
  let p=0;
  for(let i=1;i<lines.length;i++){
    const [r,g,b,a]=lines[i].split(",").map(Number);
    imgData.data[p++]=r;
    imgData.data[p++]=g;
    imgData.data[p++]=b;
    imgData.data[p++]=a;
  }
  ctx.putImageData(imgData,0,0);
  preview.src=canvas.toDataURL();
}

function renderFromTXT(){
  if(preview.src==="")return;
}

function applySize(){
  if(!lastImage)return;
  const nw=w.value||canvas.width;
  const nh=h.value||canvas.height;
  canvas.width=nw;
  canvas.height=nh;
  ctx.drawImage(lastImage,0,0,nw,nh);
  preview.src=canvas.toDataURL();
  generateTXT();
}
</script>

</body>
</html>
