<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>HGTI Studio</title>

<style>
:root{
  --bg:#F6F1E8;
  --primary:#2FAF9B;
  --primary-light:#6FD6C4;
  --text:#1F2A2A;
}

body{
  margin:0;
  padding:24px;
  font-family: system-ui, sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  display:flex;
  align-items:center;
  gap:16px;
  margin-bottom:20px;
}

header img{ height:56px; }

textarea{
  width:100%;
  height:140px;
  font-family: monospace;
  padding:12px;
  border-radius:10px;
  border:1px solid #ccc;
}

button{
  margin:8px 8px 8px 0;
  padding:10px 18px;
  border:none;
  border-radius:10px;
  background:var(--primary);
  color:white;
  font-size:1rem;
  cursor:pointer;
}

button.secondary{
  background:#ddd;
  color:#333;
}

.canvas-wrapper{
  position:relative;
  margin-top:24px;
  display:inline-block;
}

canvas{
  border:1px solid #999;
  image-rendering: pixelated;
}

/* ÜST KONTROLLER */
.top-controls{
  display:flex;
  gap:10px;
  align-items:center;
  background:#ffffffcc;
  padding:10px 12px;
  border-radius:12px;
  margin-bottom:10px;
  font-size:0.85rem;
}

.top-controls input{
  width:70px;
}
</style>
</head>

<body>

<header>
  <img src="logo.png" alt="Henry Games">
  <h1>HGTI Studio</h1>
</header>

<h3>TXT / HGTI → Görsel</h3>
<textarea id="textInput">
0,0=#FF0000
1,0=#00FF00
2,0=#0000FF
</textarea>
<br>
<button onclick="drawFromText()">Görsele Çevir</button>

<h3>Dosya Yükle</h3>
<input type="file" id="imageInput" accept="image/*">
<input type="file" id="textFileInput" accept=".txt,.hgti">
<br>
<button class="secondary" onclick="downloadTXT()">TXT İndir</button>

<div class="canvas-wrapper">

  <div class="top-controls">
    <label>Genişlik(px)</label>
    <input type="number" id="wInput">

    <label>Yükseklik(px)</label>
    <input type="number" id="hInput">

    <label>Piksel</label>
    <input type="number" id="pixelInput" value="10" min="1">

    <button onclick="applyResize()">Uygula</button>
  </div>

  <canvas id="canvas"></canvas>
</div>

<script>
let generatedTXT="";
let lastImageData=null;

/* ========== TXT -> GÖRSEL ========== */
function drawFromText(){
  const text=textInput.value;
  renderFromText(text);
}

function renderFromText(text){
  const pixel=Number(pixelInput.value)||10;
  const lines=text.split("\n");
  let maxX=0,maxY=0;

  lines.forEach(l=>{
    if(!l.includes("=")) return;
    const [p]=l.split("=");
    const [x,y]=p.split(",").map(Number);
    maxX=Math.max(maxX,x);
    maxY=Math.max(maxY,y);
  });

  const canvas=document.getElementById("canvas");
  const ctx=canvas.getContext("2d");
  canvas.width=(maxX+1)*pixel;
  canvas.height=(maxY+1)*pixel;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  lines.forEach(l=>{
    if(!l.includes("=")) return;
    const [p,c]=l.split("=");
    const [x,y]=p.split(",").map(Number);
    ctx.fillStyle=c;
    ctx.fillRect(x*pixel,y*pixel,pixel,pixel);
  });
}

/* ========== GÖRSEL -> TXT (OTOMATİK) ========== */
imageInput.addEventListener("change",()=>{
  const file=imageInput.files[0];
  if(!file) return;

  const img=new Image();
  img.onload=()=>{
    const w=wInput.value?Number(wInput.value):img.width;
    const h=hInput.value?Number(hInput.value):img.height;

    const c=document.createElement("canvas");
    c.width=w;
    c.height=h;
    const ctx=c.getContext("2d");
    ctx.drawImage(img,0,0,w,h);

    lastImageData=ctx.getImageData(0,0,w,h);
    generateTXT();
    drawFromImageData();
  };
  img.src=URL.createObjectURL(file);
});

/* ========== TXT DOSYASI YÜKLE -> GÖRSEL ========== */
textFileInput.addEventListener("change",()=>{
  const file=textFileInput.files[0];
  if(!file) return;

  const reader=new FileReader();
  reader.onload=()=>{
    const content=reader.result;
    textInput.value=content;
    renderFromText(content);
  };
  reader.readAsText(file);
});

/* ========== ORTAK ========== */
function generateTXT(){
  const {data,width,height}=lastImageData;
  let out=[];

  for(let y=0;y<height;y++){
    for(let x=0;x<width;x++){
      const i=(y*width+x)*4;
      const r=data[i],g=data[i+1],b=data[i+2],a=data[i+3];
      if(a>0){
        out.push(`${x},${y}=#${hex(r)}${hex(g)}${hex(b)}`);
      }
    }
  }
  generatedTXT=out.join("\n");
}

function drawFromImageData(){
  const pixel=Number(pixelInput.value)||10;
  const {data,width,height}=lastImageData;

  const canvas=document.getElementById("canvas");
  const ctx=canvas.getContext("2d");
  canvas.width=width*pixel;
  canvas.height=height*pixel;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  for(let y=0;y<height;y++){
    for(let x=0;x<width;x++){
      const i=(y*width+x)*4;
      const r=data[i],g=data[i+1],b=data[i+2],a=data[i+3];
      if(a>0){
        ctx.fillStyle=`rgb(${r},${g},${b})`;
        ctx.fillRect(x*pixel,y*pixel,pixel,pixel);
      }
    }
  }
}

function applyResize(){
  if(lastImageData) drawFromImageData();
}

function hex(v){
  return v.toString(16).padStart(2,"0").toUpperCase();
}

function downloadTXT(){
  if(!generatedTXT) return;
  const blob=new Blob([generatedTXT],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="image.hgti";
  a.click();
}
</script>

</body>
</html>
